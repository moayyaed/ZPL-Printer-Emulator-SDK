<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ZPLPrinter Emulator SDK - ASP.NET ZPLViewer Sample</title>

    <link rel="stylesheet" href="https://ajax.aspnetcdn.com/ajax/bootstrap/3.3.6/css/bootstrap.min.css" />

    <style type="text/css">
        .navbar-custom {
            background-color: #333;
            color: #fff;
            border-radius: 0;
        }

            .navbar-custom .navbar-nav > li > a {
                color: #fff;
            }

            .navbar-custom .navbar-nav > .active > a, .navbar-nav > .active > a:hover, .navbar-nav > .active > a:focus {
                color: #ffffff;
                background-color: transparent;
            }

            .navbar-custom .navbar-nav > li > a:hover, .nav > li > a:focus {
                text-decoration: none;
                background-color: #acdaee;
            }

            .navbar-custom .navbar-brand {
                color: #eee;
            }

            .navbar-custom .navbar-toggle {
                background-color: #eee;
            }

            .navbar-custom .icon-bar {
                background-color: #acdaee;
            }


        .round.white {
            background-color: #fff;
            color: #2196F3
        }

        .round {
            display: inline-block;
            height: 64px;
            width: 64px;
            line-height: 64px;
            -moz-border-radius: 32px;
            border-radius: 32px;
            background-color: #222;
            color: #FFF;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">
                    <div class="round white">
                        <img alt="Neodynamic" src="//www.neodynamic.com/images/ZPLPrinterEmulatorSDK-32x32.png">
                    </div>
                </a>
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a href="//www.neodynamic.com/products/zpl-printer-emulator-sdk/" target="_blank" class="navbar-brand">ZPLPrinter Emulator SDK for .NET Standard</a>
                <span class="label label-danger">Version 4.0.0.0</span>
            </div>
            <div class="navbar-collapse collapse">
                <div class="pull-right">
                    <a class="btn btn-info" href="//www.neodynamic.com/products/zpl-printer-emulator-sdk/download/" target="_blank"><i class="glyphicon glyphicon-download-alt"></i> Download ZPLPrinter Emulator SDK for .NET</a>
                    
                </div>
            </div>


        </div>
    </div>
    <br /><br /><br />
    <div class="container body-content">
        <form id="formZPL" name="formZPL">
            <div class="row">
                <div class="col-md-6">
                    <h2>ZPL Printer Settings</h2>
                    <div class="form-group well">
                        <div class="row">
                            <div class="col-md-4">
                                <label for="lstPrinterDpi">DPI:</label>
                                <select id="lstPrinterDpi" name="lstPrinterDpi" class="form-control input-sm">
                                    <option>152 dpi (6 dpmm)</option>
                                    <option selected>203 dpi (8 dpmm)</option>
                                    <option>300 dpi (12 dpmm)</option>
                                    <option>600 dpi (24 dpmm)</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="txtLabelWidth">Label Width (inch):</label>
                                <input type="number" class="form-control input-sm allow_decimal" id="txtLabelWidth" name="txtLabelWidth" value="4">
                                <label><input id="chkForceLabelWidth" name="chkForceLabelWidth" type="checkbox"><strong><small>&nbsp;Force Label Width?</small></strong></label>
                            </div>
                            <div class="col-md-4">
                                <label for="txtLabelHeight">Label Height (inch):</label>
                                <input type="number" class="form-control input-sm allow_decimal" id="txtLabelHeight" name="txtLabelHeight" value="6">
                                <label><input id="chkForceLabelHeight" name="chkForceLabelHeight" type="checkbox"><strong><small>&nbsp;Force Label Height?</small></strong></label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <label for="cpRibbonColor">Ribbon Color:</label>
                                <input id="cpRibbonColor" name="cpRibbonColor" type="color" class="form-control input-sm" value="#000000">
                            </div>
                            <div class="col-md-4">
                                <label for="cpBackColor">Label BackColor:</label>
                                <input id="cpBackColor" name="cpBackColor" type="color" class="form-control input-sm" value="#ffffff">
                            </div>
                            <div class="col-md-4">
                                <div class="checkbox">
                                    <label><input id="chkAntialias" name="chkAntialias" type="checkbox" checked><strong><small>Apply Anti-Aliasing?</small></strong></label>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <label for="lstOutputFormat">Output Format:</label>
                                <select id="lstOutputFormat" name="lstOutputFormat" class="form-control input-sm">
                                    <option value="PNG" selected>PNG</option>
                                    <option value="JPG">JPG</option>
                                    <option value="PDF">PDF</option>
                                    <option value="PCX">PCX</option>
                                    <option value="GRF">Zebra ZPL GRF</option>
                                    <option value="EPL">Zebra EPL Binary</option>
                                    <option value="FP">Honeywell-Intermec FingerPrint Binary</option>
                                    <option value="NV">EPSON ESC/POS NV Binary</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="lstOutputRotate">Rotate:</label>
                                <select id="lstOutputRotate" name="lstOutputRotate" class="form-control input-sm">
                                    <option selected>None</option>
                                    <option>Rot90Clockwise</option>
                                    <option>Rot180</option>
                                    <option>Rot270Clockwise</option>
                                </select>
                            </div>
                            <div class="col-md-4">

                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <h2>ZPL Commands</h2>
                    <div class="form-group well">
                        <textarea id="zplCommands" name="zplCommands" rows="6" cols="80" class="form-control input-sm" placeholder="Type or Paste ZPL commands here..." style="font-family: monospace;min-width: 100%"></textarea>
                        <div class="row">
                            <div class="col-md-4">
                                <label for="zplFile"><i class="glyphicon glyphicon-folder-open" aria-hidden="true"></i>&nbsp;&nbsp;Open ZPL file...</label>
                                <input class="form-control input-sm" type="file" id="zplFile" onchange="readZplFile();">
                            </div>
                            <div class="col-md-3">
                                <div class="checkbox">
                                    <label><input id="chkUTF8" name="chkUTF8" type="checkbox"><strong><small>Use UTF-8</small></strong></label>
                                </div>
                            </div>
                            <div class="col-md-5">
                                <br />
                                <button type="button" onclick="processZPL();" class="btn btn-danger"><i class="glyphicon glyphicon-refresh" aria-hidden="true"></i>&nbsp;&nbsp;Process &amp; Preview ZPL...</button>

                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </form>
        <div class="row">
            <div class="col-md-12">

                <h2>ZPL Rendering Output</h2>
                <div class="form-group well">
                    <div class="row">
                        <div class="col-md-1">
                            <button type="button" class="btn btn-info" onclick="prevLabelImage();"><i class="glyphicon glyphicon-triangle-left" aria-hidden="true"></i></button>
                        </div>
                        <div class="col-md-10 text-center">
                            <div class="row">
                                <div class="col-md-4">
                                    <h4 id="lblPreview"></h4>
                                </div>
                                <div class="col-md-3">
                                    <h4 class=" pull-right">Rendered Elements:</h4>
                                </div>
                                <div class="col-md-5">
                                    <select id="lstRenderedElements" class="form-control input-sm" onchange="highlightRenderedElement()"></select>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-1">
                            <button type="button" class="btn btn-info pull-right" onclick="nextLabelImage();"><i class="glyphicon glyphicon-triangle-right" aria-hidden="true"></i></button>
                        </div>
                    </div>
                    <hr />
                    <div class="text-center">
                        <img id="imgLabelPreview" />
                        <canvas id="myCanvas"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <div class="text-center">
                <a class="btn btn-success btn-lg" href="//www.neodynamic.com/products/zpl-printer-emulator-sdk/" target="_blank"><i class="glyphicon glyphicon-info-sign"></i> About ZPLPrinter Emulator SDK for .NET</a>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <a class="btn btn-info btn-lg" href="//www.neodynamic.com/products/zpl-printer-emulator-sdk/download/" target="_blank"><i class="glyphicon glyphicon-download-alt"></i> Download ZPLPrinter Emulator SDK for .NET</a>
            </div>
            <hr />
            <p>
                Powered by <a href="//www.neodynamic.com/products/zpl-printer-emulator-sdk/" target="_blank">ZPLPrinter Emulator SDK for .NET</a>
                &nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;
                <i class="icon-user"></i> <a href="https://www.neodynamic.com/spport" target="_blank">Contact Tech Support</a>
            </p>
            <p>
                &copy; Copyright
                <script type="text/javascript">
                    var theDate = new Date()
                    document.write(theDate.getFullYear())
                </script> - Neodynamic SRL<br /><a href="//www.neodynamic.com" alt="Neodynamic Website">https://www.neodynamic.com</a><br />All rights reserved.
            </p>

        </footer>
    </div>

    <div id="alertModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title"><span class="label label-danger"><i class="glyphicon glyphicon-warning-sign"></i></span> Error</h4>
                </div>
                <div class="modal-body text-center">
                    <p></p>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-default" data-dismiss="modal">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="downloadModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title"><span class="label label-primary"><i class="glyphicon glyphicon-info-sign"></i></span> Download</h4>
                </div>
                <div class="modal-body text-center">
                    <p></p>
                    <a id="outputDownload" href="#" target="_blank" class="btn btn-lg btn-info"><i class="glyphicon glyphicon-cloud-download"></i> Click here to download!</a>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-default" data-dismiss="modal">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://ajax.aspnetcdn.com/ajax/jquery/jquery-2.2.0.min.js"></script>
    <script src="https://ajax.aspnetcdn.com/ajax/bootstrap/3.3.6/bootstrap.min.js"></script>

    <script>

        var _image_icon = "no-image-placeholder.png";

        var _image_processing = "gear.gif";

        var _preview_title = "Label Preview";

        $(function () {
            $('.allow_decimal').on('input', function () {
                match = (/(\d{0,2})[^.]*((?:\.\d{0,2})?)/g).exec(this.value.replace(/[^\d.]/g, ''));
                this.value = match[1] + match[2];
            });

            $('#imgLabelPreview').attr("src", _image_icon);

            $('#lblPreview').text(_preview_title);

            //set sample ZPL commands
            $('#zplCommands').val('^XA^FO20,30^GB750,1100,4^FS^FO20,30^GB750,200,4^FS^FO20,30^GB750,400,4^FS^FO20,30^GB750,700,4^FS^FO20,226^GB325,204,4^FS^FO30,40^ADN,36,20^FDShip to:^FS^FO30,260^ADN,18,10^FDPart number #^FS^FO360,260^ADN,18,10^FDDescription:^FS^FO30,750^ADN,36,20^FDFrom:^FS^FO150,125^ADN,36,20^FDAcme Printing^FS^FO60,330^ADN,36,20^FD14042^FS^FO400,330^ADN,36,20^FDScrew^FS^FO70,480^BY4^B3N,,200^FD12345678^FS^FO150,800^ADN,36,20^FDMacks Fabricating^FS^FO200,850^GFA,6525,6525,29,,:::1F,7FC,7FF,IF8,IFE,JF8,JFE,KF,KFC,LF,LFC,LFE,MF8,MFE,NF,NFC,OF,OFC,OFE,PF8,PFE,QF8,QFC,RF,RFC,SF,SF8,SFE,TF8P01F,TFEO0KF,UFM01MF,UFCK03NFE,VFJ03PF8,VFC007QFE,VFE0TF8,gRFE,gSF,gSFC,gSFE,gTF8,gTFC,gTFE,gUF,gUF8,gUFE,gVF,gVF8,gVFC,gVFE,gWF8,gWFC,gWFE,gXF,:gXF8,gXFC,:gXFE,7gWFE,7gXF,3gXF,0gXF8,03gWF8,01gWF8,007gVF8,001gVFC,I07gUFC,I03gUFC,J0gIFC0PFC,J03gHF003OFC,K0gGFCI0OFC,K07gF8I03NFC,K01gFJ01NFC,L07YFK07MFC,L01XFEK01MFC,M0XFEL07LF8,M03WFCL03LF8,N0WF8M0LF8,N03VF8M03KF8,N01VFO0KF,O07UFO07JF,O01TFEO01JF,P0TFEP07FFE,P07SFCP01FFE,P03SF8Q0FFC,P03SF8Q03F8,P03SFS06,P01SF,P01RFE,:Q0RFC,Q0RF8,:Q07QF,:Q07PFE,Q03PFE,:Q03PFC,Q01PFC,:Q01PFE,R0PFE,:R0QF,R07PF,R07PF8,R07PFC,R03QF,R03QF8,R03QFE,R01RF8,R01RFE,R01SF,S0SFC,S0TF,S07SFC,S07SFE,S03TF8,S01TFE,S01UF8,T0UFC,T07UF,T07UFC,T03UFE,T01VF8,U0VFC,U07UFC,U03UFE,U01UFE,V0UFEM0PF8,V07TFEL07QF,V03TFCL0RFC,W0TFCK03RFE,W07SF8K07SF,W01SFL0TF8,X07RFL0TFC,X03QFEK01TFC,Y07PFCK01TFE,Y01PF8K03TFE,g03OFL07UF,gG07MFCL07UF8,gG01MF8L0VF8,gH03KFEM0VFC,gI07JFM01VFC,gJ0IF8M03VFE,gU03VFE,gU07WF,gU07WF8,gU0XF8,gU0XFC,gT01XFC,gT03XFE,gT03MFE001MFE,gT07MFJ07MF,gT07LFCJ01MF8,gT0MF8K07LF8,gT0LFEL03LFC,gS01LFCL01LFC,gS03LF8M0LFE,gS03LFN07LF,gS07LFN03LF,gS07KFEN03LF8,gS0LFCN01LF8,gR01LFCN01LFC,gR01LF8O0LFC,gR03LF8O0LFE,gR03LF8O07KFE,gR07LFP07LF,::gR07LFP07LF8,gR07LFP03LF8,gR0MFP03LF8,:gR07LFP03LF8,gR07LFP07LF8,gR07LFP07LF,:gR03LF8O07LF,gR03LF8O0LFE,gR01LF8O0LFE,gR01LFCO0LFC,gS0LFCN01LF8,gS0LFEN01LF8,gS07KFEN03LF,gS03LFN07LF,gS03LF8M0LFE,gS01LFCL01LFE,gS01LFEL03LFC,gT0MFL07LF8,gT07LFCK0MF8,gT07MFJ03MF,gT03MFC001NF,gT03NFC1NFE,gT01XFE,gT01XFC,gU0XF8,gU07WF8,gU07WF,gU03WF,gU03VFE,gU01VFC,:gV0VF8,gV07UF8,gV07UF,gV03UF,gV03TFE,gV01TFC,gW0TFC,gW0TF8,gW07SF,gW03RFE,gW01RFC,gX07QF8,gX01PFC,,:::^FS^XZ');

            processZPL();
        });

        var _zpl_output_buffer = null;
        var _this = this;

        function processZPL() {
            $('#imgLabelPreview').attr("src", _image_processing);
            $('#lblPreview').text(_preview_title);
            _currentLabelIndex = 0;
            _maxNumOfLabels = 0;
            _zpl_output_buffer = null;

            _this.fillRenderedElements();
            _this.highlightRenderedElement();

            $.post("ProcessZPL/ProcessRequest", $('#formZPL').serialize(), function (result) {
                if (JSON) {
                    try {
                        _zpl_output_buffer = result;
                        if (_zpl_output_buffer.error) {
                            $('#imgLabelPreview').attr("src", _image_icon);
                            myAlert(_zpl_output_buffer.error)
                        } else if (_zpl_output_buffer.labelImages) {
                            _currentLabelIndex = 0;
                            _maxNumOfLabels = _zpl_output_buffer.labelImages.length;
                            _this.showLabelImage();
                        } else if (_zpl_output_buffer.labelPDF) {
                            $('#imgLabelPreview').attr("src", _image_icon);
                            myDownload("The specified ZPL commands were converted to PDF successfully.", "zpl-labels.pdf", _zpl_output_buffer.labelPDF);
                        } else if (_zpl_output_buffer.labelBinaries) {
                            $('#imgLabelPreview').attr("src", _image_icon);
                            myDownload("The specified ZPL commands were converted to " + $('#lstOutputFormat').val() + " successfully.", (_zpl_output_buffer.labelBinaries.indexOf('application/octet-stream') > 0 ? "zpl-labels." + $('#lstOutputFormat').val() : "zpl-labels.zip"), _zpl_output_buffer.labelBinaries);
                        }
                    } catch (e) {
                        $('#imgLabelPreview').attr("src", _image_icon);
                        myAlert(e.message);
                    }
                }

            }, "json");
        }

        var _currentLabelIndex = 0;
        var _maxNumOfLabels = 0;

        function showLabelImage() {
            if (_zpl_output_buffer && _zpl_output_buffer.labelImages) {
                $('#lblPreview').text("Label " + (_currentLabelIndex + 1) + " of " + _maxNumOfLabels);
                $('#imgLabelPreview').attr("src", _zpl_output_buffer.labelImages[_currentLabelIndex]);
                fillRenderedElements();
                highlightRenderedElement();
            }
        }

        function nextLabelImage() {
            if (_currentLabelIndex < _maxNumOfLabels - 1) {
                _currentLabelIndex++;
                showLabelImage();
            }
        }

        function prevLabelImage() {
            if (_currentLabelIndex > 0) {
                _currentLabelIndex--;
                showLabelImage();
            }
        }

        function fillRenderedElements() {
            $('#lstRenderedElements').empty();

            if (_zpl_output_buffer && _zpl_output_buffer.renderedElements) {
                var zplElems = _zpl_output_buffer.renderedElements[_currentLabelIndex];

                if (zplElems && zplElems.length > 0) {
                    $('#lstRenderedElements').append('<option></option>');
                    for (var i = 0; i < zplElems.length; i++) {
                        var zplEl = zplElems[i];
                        $('#lstRenderedElements').append('<option>^' + zplEl.name + (zplEl.content.trim().length > 0 ? ': `' + zplEl.content.trim() + '`' : '') + '</option>');
                    }
                }
            }
        }

        function highlightRenderedElement() {
            var img = document.getElementById("imgLabelPreview");
            var cnvs = document.getElementById("myCanvas");

            cnvs.style.position = "absolute";
            cnvs.style.left = img.offsetLeft + "px";
            cnvs.style.top = img.offsetTop + "px";
            cnvs.width = img.offsetWidth;
            cnvs.height = img.offsetHeight;

            var ctx = cnvs.getContext("2d");
            ctx.clearRect(0, 0, cnvs.width, cnvs.height);

            if (_zpl_output_buffer && _zpl_output_buffer.renderedElements) {
                var zplElems = _zpl_output_buffer.renderedElements[_currentLabelIndex];

                if (zplElems && zplElems.length > 0) {
                    var lst = document.getElementById("lstRenderedElements");
                    var zplEl = zplElems[lst.selectedIndex - 1];
                    if (zplEl && zplEl.x) {
                        ctx.fillStyle = 'rgba(255,69,0,0.5)';
                        ctx.fillRect(zplEl.x, zplEl.y, zplEl.width, zplEl.height);
                    }
                }
            }
        }

        function readZplFile() {
            var reader = new FileReader();
            reader.onload = function (e) {
                $('#zplCommands').val(reader.result);
            };
            var file = $('#zplFile')[0].files[0];
            reader.readAsText(file);
        }

        function myAlert(msg) {
            $('#alertModal').find('.modal-body p').text(msg);
            $('#alertModal').modal('show')
        }

        function myDownload(msg, downloadFileName, downloadContent) {
            $('#outputDownload').attr('download', downloadFileName);
            $('#outputDownload').attr('href', downloadContent);
            $('#downloadModal').find('.modal-body p').text(msg);
            $('#downloadModal').modal('show')
        }

    </script>

</body>
</html>